# F7: ボットステータスコマンド

## 概要

ボットがどのサーバーで稼働しているかを確認できるコマンドを追加する。ローカル環境と本番環境の両方でボットが起動していた場合に、どちらが応答しているか判別可能にする。

## ユーザーストーリー

- 開発者として、どの環境のボットが応答しているか確認するために、ステータスコマンドを使いたい
- 運用者として、ボットの稼働状態（起動時刻・稼働時間）を把握するために、情報コマンドを使いたい

## 入出力仕様

### 入力

- `@bot status` または `@bot info` コマンド（メンション付き / 自動返信チャンネル両対応）

### 出力

**環境識別子あり:**

```
🤖 ボットステータス
ホスト: prod-server-01
環境: production
起動: 2026-02-05 10:30:00 JST（稼働 2時間15分）
```

**環境識別子なし:**

```
🤖 ボットステータス
ホスト: DESKTOP-ABC123
起動: 2026-02-05 10:30:00 JST（稼働 2時間15分）
```

## 受け入れ条件

- [ ] AC1: `@bot status` コマンドでボットステータスが表示される
- [ ] AC2: `@bot info` コマンドでも同じステータスが表示される（エイリアス）
- [ ] AC3: ホスト名が表示される（OSから取得）
- [ ] AC4: 起動時刻がJSTで表示される（設定のタイムゾーンを使用）
- [ ] AC5: 稼働時間が「N時間M分」形式で表示される
- [ ] AC6: 環境識別子が設定されている場合は表示される
- [ ] AC7: 環境識別子が未設定の場合は「環境」行が省略される
- [ ] AC8: コマンドは大文字小文字不問で認識される
- [ ] AC9: IPアドレス、ファイルパス、環境変数の値、DB接続先詳細は表示されない
- [ ] AC10: 自動返信チャンネル（F6）でもコマンドが動作する

## 設定

### 環境変数

| 変数名 | 説明 | デフォルト | 例 |
|--------|------|-----------|-----|
| `ENV_NAME` | 環境識別子（オプション） | `""` (空文字 = 非表示) | `production`, `development` |

### 設定例（`.env`）

```bash
# 環境識別子（オプション、空の場合は非表示）
ENV_NAME=production
```

## 使用LLMプロバイダー

**不要** — 単純な情報表示のみのためLLM処理は不使用

## 技術設計

### 起動時刻の記録

`src/main.py` でモジュールレベル変数に起動時刻を記録する:

```python
import src.slack.handlers as handlers_module

handlers_module.BOT_START_TIME = datetime.now(tz=ZoneInfo(settings.timezone))
```

### キーワード判定

```python
_STATUS_KEYWORDS = ("status", "info")
```

`_process_message` 内で他のキーワード判定と同様に、`status` / `info` キーワードを検出してステータス応答を返す。

### ステータス情報の構築

```python
def _build_status_message(timezone: str, env_name: str) -> str:
    hostname = socket.gethostname()
    now = datetime.now(tz=ZoneInfo(timezone))
    uptime = now - BOT_START_TIME
    # ...フォーマット処理
```

### セキュリティ

以下の情報は**表示しない**:

- IPアドレス
- ファイルパス
- 環境変数の値
- DBの接続先詳細

## 関連ファイル

| ファイル | 役割 |
|---------|------|
| `src/config/settings.py` | `env_name` フィールドの追加 |
| `src/slack/handlers.py` | ステータスコマンドのキーワード判定・ハンドラ追加 |
| `src/main.py` | 起動時刻の記録 |
| `.env.example` | 新規設定項目の追加 |
| `tests/test_slack_handlers.py` | ステータスコマンドのテスト |

## テスト方針

- 単体テスト: ステータス情報の取得・フォーマット処理
- 統合テスト: ハンドラ経由のコマンド応答確認
- テスト名は `test_ac{N}_...` 形式で受け入れ条件と対応

## 考慮事項

### 将来拡張

- バージョン情報の表示
- DB接続状態の表示（接続可/不可のみ、詳細は非表示）
- メモリ使用量の表示
