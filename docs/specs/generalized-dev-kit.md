# 汎化開発キット (Claude Code Dev Kit)

## 1. 概要

本プロジェクト（AI Assistant）で構築した仕様駆動開発サイクル（サブエージェント・スキル・hooks・CLAUDE.md）を、任意のプロジェクトで再利用可能な汎用キットとして抽出・汎化する。

**出力先**: `generalized/` ディレクトリ

## 2. 背景・目的

### 背景

AI Assistantプロジェクトでは、Claude Codeを活用した以下の開発サイクルを構築した:

1. **planner** サブエージェントでIssueから実装計画を生成
2. **doc-gen** スキルで仕様書・レトロを自動生成
3. **doc-reviewer** サブエージェントで仕様書の品質レビュー
4. 仕様書に基づいて実装
5. **test-runner** サブエージェントでテスト・lint・型チェックを自動実行
6. **fix-reviews** スキルでPRレビュー指摘に対応
7. **doc-edit** スキルで既存ドキュメントを安全に更新
8. **hooks** でタスク完了・確認待ちをデスクトップ通知

このサイクルはプロジェクト固有の要素（Slack Bot、LLMプロバイダー設定等）と汎用的な開発メソドロジー要素が混在している。汎用部分を抽出することで、他プロジェクトでも同じ開発品質を実現できる。

### 目的

- **即座に使える**: `generalized/` フォルダの内容をコピーするだけで新プロジェクトに適用可能
- **プロジェクト非依存**: 特定の言語・フレームワーク・ドメインに依存しない
- **カスタマイズ可能**: プレースホルダーと設定ガイドで各プロジェクトに適応できる

## 3. 汎化対象の分析

### 現状の構成要素と汎化判定

| 構成要素 | 現在の場所 | 汎化可否 | 理由 |
|---------|-----------|---------|------|
| **planner** エージェント | `.claude/agents/planner.md` | ✅ 汎化可 | 仕様駆動開発のプロセスは汎用的 |
| **doc-reviewer** エージェント | `.claude/agents/doc-reviewer.md` | ✅ 汎化可 | ドキュメントレビュー基準は汎用的 |
| **test-runner** エージェント | `.claude/agents/test-runner.md` | ⚠️ 要抽象化 | pytest/ruff/mypy はPython固有 → テストフレームワーク非依存に |
| **doc-gen** スキル | `.claude/skills/doc-gen/` | ✅ 汎化可 | ドキュメント生成フローは汎用的 |
| **doc-edit** スキル | `.claude/skills/doc-edit/` | ✅ 汎化可 | ドキュメント編集フローは汎用的 |
| **fix-reviews** スキル | `.claude/skills/fix-reviews/` | ✅ 汎化可 | PR指摘対応フローは汎用的 |
| **hooks (通知)** | `.claude/settings.json` + `.claude/scripts/notify.sh` | ✅ そのまま流用 | 既にクロスプラットフォーム対応済み |
| **CLAUDE.md** | `CLAUDE.md` | ⚠️ 要抽象化 | プロジェクト固有部分を除去し、テンプレート化 |
| **仕様書テンプレート** | `docs/specs/overview.md` のフォーマット | ✅ 汎化可 | テンプレート構造は汎用的 |

### 除外対象（プロジェクト固有）

| 要素 | 理由 |
|------|------|
| LLM使い分けルール（`CHAT_LLM_PROVIDER` 等） | AI Assistantプロジェクト固有の設定 |
| MCP設定 | 特定プロジェクトのツール統合 |
| RAG設定 | 特定プロジェクトの知識ベース |
| `docs/specs/f1-chat.md` 等の機能仕様書 | 個別機能の仕様 |
| `docs/specs/claude-code-actions.md` | CI/CD設定は参考情報として残すが、直接の汎化対象ではない |

## 4. 出力ディレクトリ構造

```
generalized/
├── README.md                          # キット全体の説明・導入手順
├── .claude/
│   ├── agents/
│   │   ├── planner.md                 # 実装計画立案エージェント（汎化版）
│   │   ├── doc-reviewer.md            # ドキュメントレビューエージェント（汎化版）
│   │   └── test-runner.md             # テスト実行エージェント（汎化版・言語非依存）
│   ├── skills/
│   │   ├── doc-gen/
│   │   │   └── SKILL.md              # ドキュメント生成スキル（汎化版）
│   │   ├── doc-edit/
│   │   │   └── SKILL.md              # ドキュメント編集スキル（汎化版）
│   │   └── fix-reviews/
│   │       └── SKILL.md              # レビュー指摘対応スキル（汎化版）
│   ├── scripts/
│   │   └── notify.sh                 # クロスプラットフォーム通知スクリプト
│   └── settings.json                  # hooks設定（通知hooks）
├── CLAUDE.md.template                 # CLAUDE.md テンプレート
├── docs/
│   ├── specs/
│   │   └── .gitkeep                  # 仕様書配置場所
│   └── retro/
│       └── .gitkeep                  # レトロスペクティブ配置場所
└── CUSTOMIZATION.md                   # カスタマイズガイド
```

## 5. 各成果物の汎化設計

### 5.1 planner エージェント（汎化版）

**変更方針**: プロジェクト固有参照を汎用参照に置換

| 現在（プロジェクト固有） | 汎化後 |
|------------------------|--------|
| `src/db/models.py` への参照 | 「プロジェクトのデータモデル定義」への一般参照 |
| `LLMプロバイダー` セクション | 「外部サービス・依存関係」セクションに一般化 |
| `src/` 固定パス | 「ソースコードディレクトリ」として可変化 |
| AC番号の `F{N}` 形式 | そのまま維持（汎用的に使える命名規則） |

**維持する要素**:
- 計画プロセス（要件分析→コードベース調査→技術仕様→AC定義→テスト方針）
- 出力フォーマット（8セクション構成）
- 出力前チェックリスト
- 禁止事項（実装詳細への踏み込み防止）

### 5.2 doc-reviewer エージェント（汎化版）

**変更方針**: レビュー基準の参照先を汎用化

| 現在 | 汎化後 |
|------|--------|
| `docs/specs/doc-review-agent.md` 参照 | 仕様書が存在する場合はそれを参照、なければ内蔵基準を使用 |
| `CLAUDE.md` のコーディング規約参照 | `CLAUDE.md` が存在する場合に参照 |

**維持する要素**:
- レビュープロセス概要
- 出力フォーマット（✅ 良好 / ⚠️ 改善 / 📊 総評）
- 仕様書がSingle Source of Truthであるという設計方針

### 5.3 test-runner エージェント（汎化版）

**変更方針**: 言語・フレームワーク非依存化（最大の変更点）

| 現在（Python固有） | 汎化後（言語非依存） |
|-------------------|---------------------|
| `uv run pytest` | プロジェクト定義のテストコマンド |
| `uv run ruff check src/ tests/` | プロジェクト定義のlintコマンド |
| `uv run mypy src/` | プロジェクト定義の型チェックコマンド |
| `tests/*.py` 固定パス | テストディレクトリのパターンで検索 |
| `test_ac{N}_...` 命名規則 | 維持（AC対応テスト名は汎用的） |

**設計**: エージェント内で「プロジェクトのテスト設定を検出する」ステップを追加

```
検出順序:
1. CLAUDE.md にテストコマンドが定義されていればそれを使用
2. package.json があれば npm test / npx jest 等
3. pyproject.toml / setup.py があれば pytest
4. Makefile があれば make test
5. Cargo.toml があれば cargo test
6. go.mod があれば go test
7. 上記いずれもなければユーザーに確認
```

**出力フォーマット**: 維持（成功/失敗のレポート構造は言語非依存）

### 5.4 doc-gen スキル（汎化版）

**変更方針**: プロジェクト固有の情報収集パスを汎用化

| 現在 | 汎化後 |
|------|--------|
| `find src/ -name "*${FEATURE_NAME}*"` | ソースディレクトリを動的に検出 |
| `docs/specs/f{N}-{feature-name}.md` 固定パス | `docs/specs/` への出力は維持（慣習として推奨） |
| `f1-chat.md` を参照テンプレートとして使用 | 汎用テンプレートを内蔵 |

**維持する要素**:
- `spec` / `retro` の2モード
- Issue/PR情報の自動収集（`gh` コマンド）
- ファイル命名規則（`f{N}-{feature-name}.md`）

### 5.5 doc-edit スキル（汎化版）

**変更方針**: ほぼそのまま流用可能

| 現在 | 汎化後 |
|------|--------|
| `docs/specs/*.md` 固有パス例 | 汎用的なファイルパス例に変更 |
| `git log --grep="f{N}"` | Git情報の調査は維持 |

**維持する要素**: ほぼすべて（すでに汎用的な設計）

### 5.6 fix-reviews スキル（汎化版）

**変更方針**: ほぼそのまま流用可能

| 現在 | 汎化後 |
|------|--------|
| テスト実行に test-runner を呼ぶ | 同様に test-runner を呼ぶ（test-runner側が汎化済み） |
| `docs/specs/` との整合性チェック | 仕様書ディレクトリが存在する場合のみチェック |

**維持する要素**: GraphQLでのレビュー取得、正当性判断、修正フロー

### 5.7 hooks・通知スクリプト

**変更方針**: そのまま流用（既に汎用的）

`.claude/settings.json` と `.claude/scripts/notify.sh` はプロジェクト非依存であり、そのまま含める。

### 5.8 CLAUDE.md テンプレート

**変更方針**: プロジェクト固有セクションを除去し、プレースホルダーで置換

**テンプレート構成**:

```markdown
# {プロジェクト名} — 開発ガイドライン

> プロジェクトの概要は [README.md](README.md) を参照

## プロジェクト固有設定
<!-- ここにプロジェクト固有の環境変数・設定を記載 -->

## 開発ルール

### 仕様駆動開発
（汎用ルールをそのまま記載）

### コーディング規約
<!-- テスト・lint・型チェックのコマンドをプロジェクトに合わせて記載 -->

### 作業開始時の手順
（gh コマンドベースの手順をそのまま記載）

### Git運用
（ブランチ・コミット規約をそのまま記載）

### Claudeによる実装完了時の必須手順
（8ステップをそのまま記載）

### レビュー指摘対応
（/fix-reviews の説明をそのまま記載）

### レトロスペクティブ
（レトロ生成の説明をそのまま記載）

## Claude Code 拡張機能
### Hooks
### スキル（ユーザー実行コマンド）
### サブエージェント（自動委譲タスク）
### スキルとサブエージェントの使い分け
（各セクションの説明を汎用形でそのまま記載）
```

### 5.9 CUSTOMIZATION.md（新規）

各プロジェクトへの適用手順を記載するガイドドキュメント:

1. **コピー手順**: `generalized/` の内容をプロジェクトルートにコピー
2. **CLAUDE.md の設定**: テンプレートのプレースホルダーを埋める
3. **テスト設定**: test-runner が認識するテストコマンドの設定方法
4. **仕様書の初回作成**: `/doc-gen spec` で最初の仕様書を生成する手順
5. **推奨ワークフロー**: Issue → planner → 仕様書 → 実装 → test-runner → PR → fix-reviews のフロー図

### 5.10 README.md（generalized/ 用）

キット全体の説明:

- **概要**: 何ができるキットか
- **前提条件**: Claude Code CLI がインストール済み、`gh` CLI が利用可能
- **クイックスタート**: 3ステップで導入
- **含まれるツール一覧**: エージェント3種 + スキル3種 + hooks + テンプレート
- **開発サイクル図**: 全ツールの連携フロー
- **元プロジェクト**: AI Assistantプロジェクトへのリンク

## 6. 開発サイクルフロー図

```
┌─────────────────────────────────────────────────────────────┐
│                    仕様駆動開発サイクル                         │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  [Issue作成]                                                │
│      │                                                      │
│      ▼                                                      │
│  ┌──────────┐     ┌──────────────┐                          │
│  │ planner  │────▶│ 実装計画書    │                          │
│  │ エージェント│     │ (仕様書ドラフト)│                          │
│  └──────────┘     └──────┬───────┘                          │
│                          │                                  │
│                          ▼                                  │
│                   ┌──────────────┐                           │
│                   │ doc-reviewer │ ← 品質レビュー              │
│                   │ エージェント   │                           │
│                   └──────┬───────┘                           │
│                          │                                  │
│                          ▼                                  │
│                   ┌──────────────┐                           │
│                   │  /doc-gen    │ ← 仕様書正式版生成          │
│                   │  spec スキル  │                           │
│                   └──────┬───────┘                           │
│                          │                                  │
│                          ▼                                  │
│                   ┌──────────────┐                           │
│                   │    実装       │                           │
│                   └──────┬───────┘                           │
│                          │                                  │
│                          ▼                                  │
│                   ┌──────────────┐                           │
│                   │ test-runner  │ ← テスト・lint・型チェック    │
│                   │ エージェント   │                           │
│                   └──────┬───────┘                           │
│                          │                                  │
│                          ▼                                  │
│                   ┌──────────────┐                           │
│                   │   PR作成      │                           │
│                   └──────┬───────┘                           │
│                          │                                  │
│                          ▼                                  │
│                   ┌──────────────┐                           │
│                   │ /fix-reviews │ ← レビュー指摘対応          │
│                   │ スキル        │                           │
│                   └──────┬───────┘                           │
│                          │                                  │
│                          ▼                                  │
│                   ┌──────────────┐                           │
│                   │ /doc-edit    │ ← 仕様書更新               │
│                   │ スキル        │                           │
│                   └──────┬───────┘                           │
│                          │                                  │
│                          ▼                                  │
│                   ┌──────────────┐                           │
│                   │ /doc-gen     │ ← レトロスペクティブ生成     │
│                   │ retro スキル  │                           │
│                   └──────────────┘                           │
│                                                             │
│  [全体を通して hooks による通知が動作]                           │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## 7. 汎化時の設計原則

### 7.1 プロジェクト固有情報の扱い

| 方針 | 説明 |
|------|------|
| **プレースホルダー化** | `{プロジェクト名}`, `{テストコマンド}` 等で置換 |
| **自動検出** | test-runner はプロジェクト構成から自動でツールを検出 |
| **コメントガイド** | `<!-- ここにプロジェクト固有設定を記載 -->` でカスタマイズ箇所を明示 |
| **条件分岐** | 「仕様書が存在する場合は参照、なければスキップ」のような柔軟な記述 |

### 7.2 言語の扱い

汎化版のドキュメント・エージェント定義は**日本語を維持**する。理由:
- 元プロジェクトの開発言語が日本語
- スキル・エージェントの呼び出しは自然言語で行うため、使用言語は重要
- 必要に応じて英語版を別途作成可能（本Issue のスコープ外）

### 7.3 依存関係

汎化キットの前提条件:
- **Claude Code CLI** がインストール済み
- **GitHub CLI (`gh`)** が利用可能（Issue/PR操作に必要）
- **Git** が利用可能
- プロジェクト固有のビルドツール・テストフレームワークは各プロジェクトで設定

## 8. 受け入れ条件

- [ ] AC1: `generalized/` ディレクトリが作成され、設計通りのファイル構造を持つ
- [ ] AC2: 3つのサブエージェント（planner, doc-reviewer, test-runner）が汎化されている
- [ ] AC3: 3つのスキル（doc-gen, doc-edit, fix-reviews）が汎化されている
- [ ] AC4: test-runner が言語・フレームワーク非依存で動作する設計になっている
- [ ] AC5: CLAUDE.md テンプレートがプロジェクト固有情報をプレースホルダー化している
- [ ] AC6: hooks・通知スクリプトがそのまま含まれている
- [ ] AC7: CUSTOMIZATION.md に導入・カスタマイズ手順が記載されている
- [ ] AC8: generalized/README.md にキットの概要・クイックスタートが記載されている
- [ ] AC9: 元プロジェクトの `docs/specs/`, `.claude/` は変更されていない（影響なし）
- [ ] AC10: 汎化版のエージェント・スキルにプロジェクト固有の参照（LLMプロバイダー, Slack Bot等）が含まれていない

## 9. 実装順序

1. `generalized/` ディレクトリ構造の作成
2. hooks・通知スクリプトのコピー（変更なし）
3. planner エージェントの汎化
4. doc-reviewer エージェントの汎化
5. test-runner エージェントの汎化（最大の変更）
6. doc-gen スキルの汎化
7. doc-edit スキルの汎化
8. fix-reviews スキルの汎化
9. CLAUDE.md テンプレートの作成
10. CUSTOMIZATION.md の作成
11. generalized/README.md の作成

## 10. リスク

| リスク | 対策 |
|--------|------|
| 汎化しすぎて具体性がなくなる | 元プロジェクトの具体例をCUSTOMIZATION.mdに残す |
| test-runner の自動検出が不十分 | CLAUDE.md にテストコマンドを明示する運用を推奨 |
| 日本語のみで利用者が限定される | 将来の英語版対応をCUSTOMIZATION.mdに記載 |
| 新プロジェクトに不要なスキルがある | 不要なスキルは削除してよい旨をCUSTOMIZATION.mdに記載 |

---
> **注意:** この設計書はLLMによる自動生成です。実装前に必ずレビューしてください。
