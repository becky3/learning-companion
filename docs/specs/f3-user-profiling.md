# F3: ユーザー情報抽出

## 概要

ボットとの会話からユーザーの興味・スキル・学習目標を自動的に抽出し、DBに蓄積する。蓄積された情報はF4（トピック提案）やF2（情報収集のパーソナライズ）で活用する。

## ユーザーストーリー

- ユーザーとして、会話するだけで自分の興味やスキルが自動的に記録され、パーソナライズされた提案を受けたい。
- ユーザーとして、ボットが自分について何を記録しているか確認したい。

## 入出力仕様

### 情報抽出

**入力:**
- ユーザーとの会話メッセージ（F1チャット応答後に非同期で処理）

**処理:**
1. ローカルLLMに会話内容を渡し、以下を構造化データとして抽出:
   - interests: 興味のあるトピック（例: "Python", "機械学習", "Webフロントエンド"）
   - skills: 持っているスキル・経験レベル（例: "Python:中級", "React:初心者"）
   - goals: 学習目標（例: "機械学習エンジニアになりたい"）
2. 既存のuser_profilesレコードとマージ（上書きではなく追加・更新）
3. DBに保存

**LLMプロンプト例:**
```
以下の会話から、ユーザーの学習に関する情報を抽出してJSON形式で返してください。
該当する情報がない場合は空配列を返してください。

{
  "interests": ["トピック1", "トピック2"],
  "skills": [{"name": "スキル名", "level": "初心者|中級|上級"}],
  "goals": ["目標1"]
}

会話:
{message}
```

**出力:**
- user_profilesテーブルの更新

### プロファイル確認

**入力:**
- ユーザーが「自分のプロファイルを見せて」等のリクエスト

**出力（Slackメッセージ例）:**
```
:bust_in_silhouette: あなたのプロファイル

【興味】Python, 機械学習, データ分析
【スキル】Python (中級), SQL (初心者)
【目標】データサイエンティストとして転職したい

:pencil2: 修正したい場合は教えてね！
```

## 受け入れ条件

- [ ] AC1: 会話メッセージからinterests/skills/goalsをローカルLLMで抽出できる
- [ ] AC2: 抽出結果をuser_profilesテーブルに保存・マージできる
- [ ] AC3: 抽出処理はチャット応答後に非同期で実行される（応答速度に影響しない）
- [ ] AC4: ユーザーが自分のプロファイルを確認できる
- [ ] AC5: LLMの抽出結果がJSON形式でない場合、エラーをログに記録し処理をスキップする

## 使用LLMプロバイダー

**ローカル (LM Studio)** — 定型的な抽出タスクのため

## 関連ファイル

| ファイル | 役割 |
|---------|------|
| `src/services/user_profiler.py` | 抽出ロジック・プロファイルマージ |
| `src/slack/handlers.py` | プロファイル確認リクエスト |
| `src/db/models.py` | user_profilesモデル |

## テスト方針

- LLMをモックして抽出ロジックをテスト
- プロファイルマージ（既存データとの統合）のユニットテスト
- JSON解析失敗時のエラーハンドリングテスト
