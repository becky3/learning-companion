# ドキュメント生成・編集スキル

## 概要

プロジェクトドキュメント（仕様書・引き継ぎ・レトロスペクティブ）の新規作成と既存ドキュメントの編集をClaude Codeスキルとして実装する。

## 背景

ドキュメント作成タスクは定型的な構造を持ち、既存のテンプレートやフォーマットに従う必要がある。これをスキル化することで:
- ドキュメント作成の手間を削減
- 一貫したフォーマットを保証
- Issue/PR/コミット履歴から自動的に情報を収集
- CLAUDE.mdのルールに準拠したドキュメントを生成

## ユーザーストーリー

### doc-gen スキル
- 開発者として、`/doc-gen spec <feature-name>` で機能仕様書を自動生成したい
- 開発者として、`/doc-gen handover` で現在の作業状況から引き継ぎ資料を生成したい
- 開発者として、`/doc-gen retro <feature-name>` で実装完了後のレトロスペクティブを生成したい

### doc-edit スキル
- 開発者として、`/doc-edit <file-path>` で既存ドキュメントを安全に更新したい
- 開発者として、仕様変更時に関連ドキュメントを素早く修正したい

## 技術仕様

### doc-gen スキル

**メタデータ:**
```yaml
name: doc-gen
description: プロジェクトドキュメント（仕様書・引き継ぎ・レトロ）の新規作成
user-invocable: true
allowed-tools: Bash, Read, Edit, Write, Grep, Glob
argument-hint: [spec|handover|retro] [feature-name]
```

**引数パターン:**
- `spec <feature-name>`: 仕様書を `docs/specs/f{N}-{feature-name}.md` に生成
- `handover`: 引き継ぎ資料を `docs/handover/YYYY-MM-DD-{内容}.md` に生成
- `retro <feature-name>`: レトロを `docs/retro/f{N}-{feature-name}.md` に生成

**処理フロー:**
1. 引数から生成対象を判定（spec/handover/retro）
2. 既存ドキュメントを参照してフォーマットを理解
3. 関連するIssue/PR/コミット履歴を調査
4. テンプレートに従ってドキュメントを生成
5. CLAUDE.mdの命名規則に従ってファイル保存
6. 既存ファイルがある場合は警告を表示
7. 生成結果を表示

**仕様書生成の詳細:**
1. Issue一覧から該当機能のIssue番号を特定
2. Issue本文・コメントから要件を抽出
3. 関連するコード実装を調査
4. 以下のセクションを含む仕様書を生成:
   - 概要
   - 背景
   - ユーザーストーリー
   - 技術仕様
   - 受け入れ条件 (AC)
   - 関連ファイル

**引き継ぎ資料生成の詳細:**
1. 現在のブランチ・PR状況を確認
2. 最近のコミット履歴から完了作業を抽出
3. 未完了のIssueを確認
4. CLAUDE.mdのテンプレートに従って生成:
   - 完了済み作業
   - 未着手・作業中
   - 注意事項・判断メモ
   - 環境メモ

**レトロ生成の詳細:**
1. 該当機能のPR・コミット履歴を調査
2. Issue・PR内の議論を確認
3. 実装時の判断・学びを抽出
4. 以下のセクションを含むレトロを生成:
   - 何を実装したか
   - うまくいったこと
   - 改善点
   - 次に活かすこと

### doc-edit スキル

**メタデータ:**
```yaml
name: doc-edit
description: 既存ドキュメントの更新・修正（仕様変更反映、情報追加など）
user-invocable: true
allowed-tools: Bash, Read, Edit, Write, Grep, Glob
argument-hint: <file-path> [update-reason]
```

**引数パターン:**
- `<file-path>`: 編集対象のファイルパス（必須）
- `[update-reason]`: 更新理由（オプション）

**処理フロー:**
1. 対象ファイルの存在確認
2. ファイルを読み込み、現在の構造を理解
3. 更新理由が指定されていればそれを反映、なければ対話的に確認
4. 関連するコード変更を調査（必要に応じて）
5. ドキュメントを更新（構造を保持）
6. 変更内容のdiffを表示
7. 更新内容のサマリーを表示

**安全性担保:**
- 編集前に必ずファイルを読み込み、既存内容を理解
- 構造を壊さないよう慎重に編集
- 編集後に変更内容を明示

## 受け入れ条件

### doc-gen スキル

- [ ] AC1: `/doc-gen spec test-feature` で仕様書が正しく生成される
- [ ] AC2: 生成される仕様書が既存の仕様書と同じフォーマットを持つ
- [ ] AC3: `/doc-gen handover` で引き継ぎ資料が正しい命名（YYYY-MM-DD-*.md）で生成される
- [ ] AC4: 引き継ぎ資料がCLAUDE.mdのテンプレートに従っている
- [ ] AC5: `/doc-gen retro test-feature` でレトロが正しく生成される
- [ ] AC6: 既存ファイルがある場合に上書き警告が表示される
- [ ] AC7: Issue/PR/コミット履歴から関連情報を自動収集できる

### doc-edit スキル

- [ ] AC8: `/doc-edit docs/specs/f1-chat.md` で既存仕様書を更新できる
- [ ] AC9: 存在しないファイルパスの場合にエラーメッセージが表示される
- [ ] AC10: 編集後にファイルの構造が保持されている
- [ ] AC11: 編集前後の差分が明確に表示される

## 関連ファイル

| ファイル | 役割 |
|---------|------|
| `.claude/skills/doc-gen/SKILL.md` | doc-genスキル定義 |
| `.claude/skills/doc-edit/SKILL.md` | doc-editスキル定義 |
| `docs/specs/*.md` | 既存仕様書（参照用） |
| `docs/handover/*.md` | 既存引き継ぎ資料（参照用） |
| `docs/retro/*.md` | 既存レトロ（参照用） |
| `CLAUDE.md` | 命名規則・テンプレート定義 |

## テスト方針

Claude Codeスキルは実行時テストが中心となるため、以下を手動で確認:

**doc-gen のテスト:**
- [ ] 各種ドキュメントが正しく生成される
- [ ] フォーマットが既存ドキュメントと一致する
- [ ] Issue/PR情報が正しく反映される

**doc-edit のテスト:**
- [ ] 既存ドキュメントが安全に更新される
- [ ] ファイル構造が保持される
- [ ] 変更差分が表示される

## 拡張性

将来的に以下の機能を追加可能:
- ドキュメント検証スキル（形式チェック、リンク切れ検出等）
- テンプレートのカスタマイズ機能
- 複数ドキュメントの統合・サマリー生成（Issue #36）
