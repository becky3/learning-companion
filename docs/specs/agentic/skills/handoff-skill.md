# セッション引き継ぎスキル

## 概要

セッション終了時の引き継ぎ処理をワンアクションで実行するスキル。MEMORY.md の更新、ジャーナル記録、次セッションへの申し送りを一括で行う。

## 背景

- セッション終了時に毎回手動で引き継ぎメモを依頼するのは非効率
- 記録内容のフォーマット統一とジャーナルによるセッション履歴の蓄積を仕組み化する

## 制約

- MEMORY.md は 200 行以内に収める（Claude Code のシステムプロンプトに読み込まれるため）
- 進行中タスク・セッション固有の情報は MEMORY.md に書かない（ジャーナルに記録する）
- 既存の MEMORY.md の内容は削除しない（知見の追記のみ）

## コマンド体系

| コマンド | 用途 |
| --- | --- |
| `/handoff` | セッション引き継ぎを実行 |
| `/handoff "メッセージ"` | カスタムメッセージ付きで引き継ぎ |

カスタムメッセージはジャーナルの「気づき・次に活かすこと」セクションに追記される。

## 処理フロー

```mermaid
flowchart TD
    A[/handoff 実行] --> B[セッション情報の収集]
    B --> C[MEMORY.md 更新]
    C --> D[journal/ に新規ファイル作成]
    D --> E[ユーザーへの報告]
```

### セッション情報の収集

以下を収集する:

- 今日のコミット履歴
- 現在のブランチとステータス
- 今日マージされた PR
- 未完了の作業（未コミットの変更、作業中のブランチ）

git/gh コマンドが使用できない場合は、該当情報を「取得できませんでした」として残りの処理を続行する。

### MEMORY.md の更新ルール

- MEMORY.md に書くもの: **頻繁に行う作業で、間違うと実害があり、lint やテストでは検知できないもの**（環境固有の罠、操作上の禁止事項など）
- 新たな知見があれば追記、なければ変更なし

### ジャーナルの作成

ジャーナルディレクトリ（`{MEMORY_DIR}/journal/`）に 1 エントリ 1 ファイルで作成する。ディレクトリが存在しない場合は作成する。

**ファイル命名**: `YYYYMMDD-HHMMSS-タイトルスラッグ.md`

- タイトルスラッグ: Issue 番号や副題を除去し、スペースをハイフンに置換。パス区切り文字や制御文字は除去する

**必須セクション**:

| セクション | 内容 |
| --- | --- |
| 概要 | 何をやったか、背景 |
| 判断 | 迷った点・選んだ選択肢・理由 |
| 結果 | 良かった / 悪かった / 未検証 |

**任意セクション**（該当する場合に記載）:

| セクション | 内容 |
| --- | --- |
| うまくいったこと | 成功パターン・再利用できる知見 |
| 改善点・ハマったこと | 問題 → 対応 → 教訓 |
| 気づき・次に活かすこと | 行動改善、技術的な学び |
| ユーザーへの提案 | プロセス改善等 |
| 残課題 | 未着手の関連タスク |

小さい PR は必須セクションのみ、大きい機能実装やハマった時は任意セクションも記載する。フォーマット詳細は `{MEMORY_DIR}/journal-guidelines.md` に従う。

## 入出力

### 入力

| 入力 | 形式 |
| --- | --- |
| `/handoff` | 引数なし |
| `/handoff "メッセージ"` | カスタムメッセージ |

メモリディレクトリが見つからない場合はエラーメッセージを表示して中断する。

### 出力

引き継ぎ結果レポート:

- MEMORY.md の更新状況（更新あり / 変更なし）
- 作成したジャーナルファイル名
- 次のセッションでやるべきことの箇条書き

## 関連ドキュメント

- `{MEMORY_DIR}/journal-guidelines.md` — ジャーナル運用ガイドライン（フォーマット詳細）
