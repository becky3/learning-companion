# ドキュメントレビューエージェント

## 概要

仕様書（`docs/specs/`）および README.md の品質をレビューするサブエージェント。仕様駆動開発の観点から、構造の完全性、情報の過不足、コードとの整合性をチェックし、改善提案を行う。

## 背景

- 仕様書の品質が低いと実装時の混乱や手戻りが発生する
- 構造の網羅性チェック、ファイル参照の整合性確認が手作業では漏れやすい
- 一貫した品質基準を適用するレビューエージェントで品質を安定させる

## 制約

### 設計方針

エージェント定義ファイルにレビュー基準の詳細は記載しない。エージェントはレビュー開始時に本仕様書を読み、レビュー基準を取得する（Single Source of Truth）。

### 許容パターン

> **TODO:#625** 許容パターンをエージェント/スキル開発ガイドラインに移行する

以下はプロジェクト方針として指摘対象外とする:

| 項目 | 許容理由 |
| --- | --- |
| エージェント定義の `model` フィールド省略 | 全エージェントで統一的に省略 |
| サブエージェント仕様書での簡略化された技術仕様 | エージェント定義ファイルとの役割分担 |

### 指摘の調査義務

Warning / Suggestion レベルの指摘であっても、以下を調査せずに「スコープ外」と判断してはならない:

| 調査対象 | 確認内容 |
| --- | --- |
| 実装との不整合 | Grep/Glob で実際のコード・ファイル構成を確認 |
| 情報の過不足 | 対象セクションの重要性と実害を確認 |
| 構造上の問題 | 修正に必要な変更量を確認 |

調査結果に基づき判断する:

- 修正コストが低く放置リスクあり → スコープ内として修正推奨
- 修正コストが高い → Issue 切り出し推奨（調査結果を添える）
- 実害なし → 「調査した結果、実害なし。理由: ...」と報告

## 役割

### 仕様書レビュー観点

| # | 観点 | 内容 |
| --- | --- | --- |
| 1 | 構造の完全性 | テンプレートに定められたセクションが揃っているか |
| 2 | 情報の過不足 | 技術詳細の過剰記載、入出力例の欠落など |
| 3 | コードとの整合性 | 関連ファイルの存在確認、docstring の仕様書パス記載 |
| 4 | テンプレート準拠 | スタイルガイドとの一貫性 |

### README.md 固有レビュー観点

| # | 観点 | 内容 |
| --- | --- | --- |
| 1 | リンク切れ | マークダウンリンクの相対パス先が存在するか（外部 URL・同一ドキュメント内アンカーは対象外） |
| 2 | プロジェクト構造の整合性 | 記載されたディレクトリ・ファイル構造が実際に存在するか |
| 3 | CLAUDE.md との一貫性 | 技術スタック・セットアップ手順・開発フローの矛盾がないか |
| 4 | CLAUDE.md への誘導 | 開発者向けに CLAUDE.md への参照が含まれているか |

### レビューモード

| モード | 用途 | レビュー範囲 |
| --- | --- | --- |
| `full` | 新規作成・大幅改訂（デフォルト） | ファイル全体を全観点でチェック |
| `diff` | 軽微な修正・レビュー指摘対応 | 変更差分のみを関連観点でチェック |

### 優先度の判定基準

| 優先度 | 基準 |
| --- | --- |
| Critical | リンク切れ、CLAUDE.md との矛盾、存在しないファイルへの参照 |
| Warning | セクション欠落、情報の過不足、構造の不整合 |
| Suggestion | 改善が望ましいが緊急性は低い |

## 処理フロー

### フルレビュー

1. **対象の特定**: ファイル指定があればそれを、なければ `docs/specs/` 全仕様書と README.md を対象
2. **ドキュメント種別の判定**: README.md か仕様書かで適用基準を切り替え
3. **構造チェック**: テンプレートのセクション有無（仕様書）/ 一般的な構成要素（README）
4. **内容の詳細レビュー**: 各セクションの品質評価、過不足検出。許容パターンは除外
5. **整合性確認**: 関連ファイル存在確認、docstring チェック（仕様書）/ リンク切れ・CLAUDE.md 一貫性（README）
6. **レポート生成**: 優先度別に整理

### 差分レビュー

1. **変更差分の取得**: 作業ツリー → merge-base → ステージング → 直近コミットの順で試行。すべて空の場合は「変更なし」として終了
2. **変更タイプの判定**: 追加/削除/変更を判別
3. **観点の絞り込み**: 構造変更なしなら構造チェックスキップ等、変更内容に関連する観点のみ適用
4. **レポート生成**: 変更箇所に対する指摘のみ出力

## 入出力

### 入力

自然言語で以下のパターンで呼び出す:

- 単一ファイル: 「doc-reviewer で docs/specs/xxx.md をレビューして」
- フルレビュー（明示）: 「doc-reviewer で xxx をフルレビューして」
- 差分レビュー: 「doc-reviewer で xxx を差分レビューして」
- 全ドキュメント: 「doc-reviewer で全ドキュメントをレビューして」

### 出力

ファイルごとに以下を含むレビュー結果:

- 良好な点
- 改善が必要な点（優先度別: Critical / Warning / Suggestion。各指摘に改善案を含む）
- 総評

## 連携

- **code-reviewer**: コード内 docstring は code-reviewer、仕様書は doc-reviewer の管轄
- **planner**: planner で生成した計画書を doc-reviewer でレビューする連携ワークフロー
