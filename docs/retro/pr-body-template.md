# PR body テンプレート導入 — レトロスペクティブ

## 概要

PR作成時の body を `.github/pull_request_template.md` で標準化し、prt 自動レビューの誤検知を防止する仕組みを導入した。

- Issue: #341
- 設計書: `docs/specs/pr-body-template.md`

## 実装の概要

### テンプレート本体

4セクション構成のシンプルなテンプレートを作成:

- **Change type**: チェックボックス形式（feat/fix/docs/docs(pre-impl)/refactor/ci/test）
- **Summary**: 箇条書きで変更概要
- **Test plan**: チェックリスト形式（省略可）
- **Related issues**: `Closes #N` で紐付け

### prt 誤検知防止

- `docs(pre-impl)` を独立した変更種別として定義
- `pr-review.yml` の prompt に Change type 参照指示を追加（prt が `docs(pre-impl)` 時にコード不整合を検出対象外にする）

### SSOT の確立

- テンプレートファイルを正（Single Source of Truth）とし、CLAUDE.md からは参照のみに正規化
- CLAUDE.md、auto-finalize スキル、auto-progress ステップ4/4 の全箇所を更新

## うまくいったこと

### 1. エージェントチーム（mixed-genius）による仕様詰めが効果的だった

2名のエージェントで仕様の詳細を議論した。

- **エージェントA**: 既存PR 5件の分析から構造案を合理的に導出。不採用セクションの根拠も明確だった
- **エージェントB**: 7つのエッジケースを網羅的に洗い出し。特に「テンプレートが邪魔になるケース」「AI vs 人間の使い分け」「SSOT 問題」の分析が的確だった

### 2. 独立レビューで同じ Critical 指摘に到達

2名のエージェントが独立してレビューした結果、「prt が PR body を直接参照する仕組みがない」という同一の Critical 指摘に到達した。この指摘がなければ「テンプレート入れたのに誤検知が減らない」という三重苦になるところだった。

### 3. 設計方針の明確化が手戻りを防いだ

- セクション数を4つに制限する方針を最初に決めたことで、「このセクションも入れたい」の膨張を防げた
- SSOT をテンプレートとする方針を決めたことで、CLAUDE.md の更新方法が明確になった

## 改善点

### 1. prt の PR body 参照メカニズムの事前調査不足

Issue #341 の背景に「prt ツールは PR body をコンテキストとして参照するため」と記載されていたが、実際に `pr-review.yml` の prompt を調査すると PR body を明示的に渡す仕組みがなかった。テンプレート設計だけでなく、prt のコンテキスト供給メカニズムまで最初から調査すべきだった。

### 2. テンプレートファイルのコミット漏れ

最初のコミットで仕様書だけをコミットし、テンプレートファイル（`.github/pull_request_template.md`）がコミットされていなかった。コードレビューで Critical として検出された。`ls -la` で確認する手順を徹底すべき。

## 次に活かすこと

1. **prt 関連の Issue では pr-review.yml の prompt を必ず確認する**: prt の挙動は prompt で制御されるため、テンプレートやドキュメントの変更だけでは不十分な場合がある
2. **SSOT の方針は早期に決める**: 情報が複数箇所に散在するドキュメント変更では、どこを正とするかを最初に決めると手戻りが減る
3. **mixed-genius パターンの独立レビューは信頼性が高い**: 同じ指摘に独立して到達した場合、その指摘の重要度は高いと判断できる
4. **新規ファイルはコミット前に存在確認**: untracked ファイルの見落としを防ぐため、`git status` の確認を徹底する
