# 移行手順

Issue: #572

仕様書改革の実施順序と依存関係をまとめる。

---

## 実施フェーズ

### Phase 0: 計画策定（完了済み）

**前提**: なし

本PRで実施。問題分析・設計判断・改善方針・移行手順の文書化。

### Phase 1: スタイルガイド策定

**前提**: Phase 0 完了

1. 文書種別の定義と分類
2. 種別ごとのテンプレート設計
3. 記述ルールの明文化
4. スタイルガイド文書の作成・レビュー

<<未決: スタイルガイドの配置先、フォーマット>>

**完了基準**:

- 分類カテゴリとディレクトリ構造が確定している
- 各種別のテンプレート（必須セクション・任意セクション・禁止セクション）が定義されている
- コミットプレフィックスの命名規則が決定している
- 1〜2ファイルでパイロット検証が完了している（テンプレート適用の実現性を確認済み）

### Phase 2: 規約の先行更新

**前提**: Phase 1 完了

個別仕様書のリファクタリング開始前に、命名規約・テスト名規約を新ルールに更新する。AIエージェントが CLAUDE.md を厳格に参照するため、規約と実態の不整合を防ぐ必要がある。

更新対象:

- `CLAUDE.md`: テスト名規約（`test_ac{N}_...` → 名前ベース）、ブランチ命名、コミットプレフィックス
- `docs/specs/git-flow.md`: ブランチ命名規約・コミットメッセージ規約
- `.github/copilot-instructions.md`: テスト名規約
- `.claude/agents/planner.md`: F番号・AC番号テンプレート
- `.claude/skills/doc-gen/SKILL.md`, `doc-edit/SKILL.md`, `test-run/SKILL.md`: f番号例示・テスト名例示

### Phase 3: 個別仕様書のリファクタリング

**前提**: Phase 2 完了

仕様書ごとにサブIssueを切り、以下をセットで実施:

- 仕様書の構成変更（テンプレート適用、AC除去、コード除去等）
- ファイルリネーム（f番号廃止）
- テスト名の更新（`test_ac1_...` → 名前ベース）
- docstring の更新

<<未決: 実施順序（依存が少ないものから着手する方針だが、具体的な順序は未定）>>

**推奨する移行順序の方針**:

1. 被参照ゼロのファイル（f3, f4, f6, f7, f10, topic-skill, handoff-skill 等）を先に着手（リスク低）
2. 単独参照のファイル群
3. 相互参照クラスタ（auto-progress / copilot-auto-fix / auto-fix-structure 等）はまとめて移行
4. `overview.md` は最後に移行（6ファイルから参照されており、カスケード影響が大きい）

**順序決定の定量的基準**:

- 被参照数（他の仕様書から参照されている回数）
- テスト数（影響を受けるテストファイル・関数の数）
- 関連する進行中 Issue/PR の有無

### Phase 4: 休止中文書の整理

**前提**: Phase 1 完了（Phase 3 と並行可能）

- `auto-fix-structure.md` のアーカイブ化
- `auto-progress.md` の整理
- その他の陳腐化した内容の除去

### Phase 5: 関連文書・設定の更新

**前提**: Phase 3 の大部分が完了

- `overview.md` のテンプレート定義を新スタイルガイドに更新
- `doc-gen-skill.md` のテンプレート参照を更新
- `README.md` との重複解消
- `docs/specs-reform/` の後始末（アーカイブまたは削除）

## 成功基準（Definition of Done）

改革全体の完了判定基準:

- 全仕様書がスタイルガイドに準拠している
- コードベース内の f番号参照がゼロになっている（docstring、コミットプレフィックス規約等）
- 仕様書内の AC セクションがゼロになっている（AC は全て Issue に移行済み）
- 全テスト名が名前ベースに移行されている（`test_ac{N}_` パターンがゼロ）
- 規約文書（CLAUDE.md, git-flow.md 等）が新体系と整合している
- 休止中・陳腐化した文書が整理されている

## 注意事項

- **移行期間中は並行開発を行わない**: 仕様書改革の移行期間中（Phase 1〜5）は通常の機能開発を凍結し、改革作業に専念する
- 各 Phase の具体的な作業内容は、前のPhaseの成果物を踏まえて詳細化する
- テスト名の変更は仕様書のリネームとセットで行い、中間状態（旧名と新名の混在）を最小限にする
- 過去のコミット履歴の f番号参照は変更不可（割り切り）
- **ロールバック方針**: 各リファクタリングは PR 単位で行うため、問題発覚時は PR 単位で revert 可能。スタイルガイド自体の方針見直しが必要になった場合は、Phase 3 の未着手分から新方針を適用する
