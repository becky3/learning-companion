# 改善予定案

Issue: #572

仕様書改革で目指す姿と改善方針をまとめる。

---

## 1. スタイルガイドの策定

全仕様書が従うべきルールを明文化する。

### 1.1 文書種別の定義

仕様書を種別ごとに分類し、それぞれに適したテンプレートを定義する。

**分類の方針**: 全体を見ながら適切な分類を決めていく。現時点で見えている軸:

- ユーザー向け機能 vs 内部基盤
- プロダクトコード vs 開発ツール・プロセス
- エージェント / スキル / チーム

<<未決: 具体的な分類カテゴリとディレクトリ構造。各仕様書を実際に見ながら決定する>>

### 1.2 種別ごとのテンプレート

各種別に必要なセクションを定義する。

**共通原則**:

- セクション名を統一する（「技術仕様」「技術設計」「設計方針」等の揺れを解消）
- 不要なセクションの混入を防ぐルールを設ける

<<未決: 各種別のテンプレート詳細（必須セクション・任意セクション・禁止セクション）>>

### 1.3 記述ルール

- **要件・制約**: 仕様書に書く（「常にこうあるべき」という恒久的な記述）
- **AC**: 仕様書には書かない。Issue に記載する
- **技術詳細**: What/Why 中心。How は反応的に追加（DD-3 参照）
- **設定値**: 具体値を仕様書にハードコードしない。設定ファイルや環境変数の存在と意味のみ記述
- **コード**: プロダクションコード（Python クラス・関数定義・疑似コード等）を仕様書に書かない。以下は許容する:
  - mermaid 図
  - CLIコマンド例（`git checkout -b`, `gh pr create` 等）
  - 設定ファイルの構造例（JSON, YAML 等）
  - shellcheck ディレクティブ等の書式例
- **過去情報**: 変更履歴・実装ステータス・PR番号を仕様書に書かない

## 2. f番号の廃止と名前ベースへの移行

- ファイル名: `f9-rag.md` → `rag.md`
- コミットメッセージ: `feat(f9):` → `feat(rag):`
- ブランチ名: `feature/f9-rag-#123` → `feature/rag-#123`
- docstring: `仕様: docs/specs/f9-rag.md` → 新パスに更新
- テスト名: `test_ac1_...` → 名前ベースに変更（AC廃止と連動）

<<未決: 名前ベースのコミットプレフィックスの命名規則（例: feat(rag), feat(chat) のように仕様書名と一致させるか）>>

### 2.1 影響を受けるファイル一覧

f番号廃止・AC廃止により更新が必要なファイルの全体像:

| カテゴリ | ファイル群 | 箇所数 | 内容 |
|---------|----------|--------|------|
| 仕様書 | `docs/specs/f*.md` (11ファイル) | — | ファイルリネーム |
| ソースコード | `src/` 配下 (18ファイル) | 36箇所 | docstring のパス参照 |
| MCPサーバー | `mcp_servers/` 配下 (15ファイル) | 45箇所 | docstring のパス参照 |
| テスト | `tests/` 配下 (33ファイル) | 406箇所 | `test_ac{N}_` テスト名 |
| 開発ガイドライン | `CLAUDE.md` | 2箇所 | テスト名規約・ブランチ命名 |
| CI/レビュー | `.github/copilot-instructions.md` | 1箇所 | テスト名規約 |
| エージェント定義 | `.claude/agents/planner.md` | 4箇所 | F番号・AC番号テンプレート |
| スキル定義 | `.claude/skills/doc-gen/SKILL.md` | 1箇所 | f番号ファイル例示 |
| スキル定義 | `.claude/skills/doc-edit/SKILL.md` | 1箇所 | f番号ファイル例示 |
| スキル定義 | `.claude/skills/test-run/SKILL.md` | 1箇所 | テスト名例示 |
| Git運用 | `docs/specs/git-flow.md` | 3箇所 | ブランチ命名・コミット規約 |

**テスト名リネームの規模**: 33ファイル・406箇所のテスト関数名を変更する必要がある。仕様書ごとにマッピングテーブルを作成し、スクリプトで一括変換するアプローチを推奨する。

## 3. 各仕様書のリファクタリング

スタイルガイドを基準に、各ファイルを個別に修正する。

**修正内容**:

- スタイルガイドのテンプレートに合わせた構成変更
- コードスニペット・設定値の除去
- ACセクションの廃止 → 要件・制約セクションへの置き換え
- 過去情報（変更履歴・実装ステータス等）の除去
- f番号の除去、ファイルリネーム
- 対応するテスト名・docstring の更新

<<未決: 各仕様書の具体的な修正内容リスト（スタイルガイド確定後にサブIssue化）>>

## 4. 休止中・陳腐化した文書の整理

- `auto-fix-structure.md`: 全体が休止中 → アーカイブまたは削除
- `auto-progress.md`: PRKit方式の記述を除去し、Copilot方式のみに整理
- `agent-teams/mixed-genius.md`: 「デフォルトキャラクター」プレースホルダーの解決

<<未決: アーカイブの方法（削除 vs docs/archive/ に移動 vs ファイル内に休止中を明記）>>

## 5. overview.md と関連文書の整合性

- `overview.md` の仕様書テンプレートを新スタイルガイドに合わせて更新
- `overview.md` と `README.md` の内容重複を解消（SSOTを明確にする）
- `doc-gen-skill.md` のテンプレート参照を新スタイルガイドに更新
- CLAUDE.md の命名規約・参照パスを更新

<<未決: overview.md 自体の位置づけ（スタイルガイドと統合するか、別に残すか）>>
