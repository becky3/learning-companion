---
name: doc-review
description: 仕様書・README.md の品質レビュー。仕様駆動開発の観点から不足・過剰な情報を検出し、改善提案を行う。
user-invocable: true
allowed-tools: Read, Grep, Glob, Bash
argument-hint: "[diff|full] [file-path]"
---

## タスク

仕様駆動開発における仕様書の品質保証を行う。ドキュメント種別に応じたレビュー基準で不足・過剰な情報を検出し、改善提案を行う。

## 引数

`$ARGUMENTS` の形式:

- `diff [file-path]`: 変更箇所のみをレビュー（差分レビュー・デフォルト）
- `full [file-path]`: ファイル全体をレビュー（フルレビュー）
- `[file-path]`: 差分レビュー（デフォルト）
- 未指定: 変更のある全ドキュメントを差分レビュー

## 仕様書の参照

レビューを開始する前に、必ず `docs/specs/agentic/agents/doc-review-agent.md` を Read ツールで読み、以下の情報を確認すること:

- レビュー対象の範囲
- レビュー基準（仕様書向け・README.md 向け）
- 処理フローの詳細
- 許容パターン（指摘対象外の項目）

**仕様書がレビュー基準の唯一の情報源（Single Source of Truth）である。**

## 処理手順

### 1. レビュー基準の把握

`docs/specs/agentic/agents/doc-review-agent.md` を Read で読み込み、レビュー基準と許容パターンを確認する。

### 2. レビューモードの判定

- `$ARGUMENTS` に `full` が含まれる → フルレビューモード
- `$ARGUMENTS` に `diff` が含まれる、またはモード未指定 → 差分レビューモード

### 3. 対象ファイルの特定

- ファイルパスが指定された場合: 該当ファイルをレビュー
- 未指定の場合: `git diff --name-only` で変更のあるドキュメントを特定

### 4. 差分レビューモード（diff）の場合

1. 変更差分の取得（以下の優先順位で試行）:
   - 作業ツリーの変更（未ステージ）: `git diff -- <file>`
   - ベースブランチとの比較: `git diff "$(git merge-base HEAD origin/develop)" HEAD -- <file>`
   - ステージング済みの変更: `git diff --cached -- <file>`
   - 直近コミットの差分（フォールバック）: `git show HEAD -- <file>`
   - すべて空の場合のみ「変更なし」として終了
2. 変更箇所に関連する観点のみをチェック
3. 変更箇所に対する指摘のみを出力
4. 既存部分への指摘は含めない

### 5. フルレビューモード（full）の場合

ファイル全体を全観点でチェックする。

### 6. ドキュメント種別判定

対象ファイルの種別を判定し、適切なレビュー基準を適用する:

- **仕様書** (`docs/specs/*.md`): AC の具体性、関連ファイルの網羅性、フロー図の有無
- **README.md**: セットアップ手順の完全性、プロジェクト構造の正確性
- **CLAUDE.md**: 開発ルールの一貫性、セクション構造

### 7. レビュー実施

仕様書 `docs/specs/agentic/agents/doc-review-agent.md` に記載されたレビュー基準に基づいて検査を実施する。許容パターンに該当する項目は指摘対象外とする。

### 8. レポート生成

下記の出力フォーマットに従ってレポートを生成する。

## 出力フォーマット

```markdown
### ファイル: {file-path}

#### ✅ 良好な点

- [箇条書きで良好な点を記載]

#### ⚠️ 改善が必要な点

**Critical（修正必須）:**

- `[セクション名]`: 問題の説明
  - 改善案: 具体的な修正提案

**Warning（修正推奨）:**

- `[セクション名]`: 問題の説明
  - 改善案: 具体的な修正提案

**Suggestion（改善検討）:**

- `[セクション名]`: 問題の説明
  - 改善案: 具体的な修正提案

#### 総評

- 仕様駆動開発の観点からの総合評価
- 実装を進める上でのリスク評価
```

## 検出した問題への対処（必須）

検出した問題を「対応範囲外」「既存問題」としてスキップしてはならない。以下のルールに従って必ず対処すること:

- **軽微な問題**（typo、構成の微修正等）: その場で修正する
- **大きな問題**（セクション追加、仕様の矛盾等）: Issue を作成して記録する
- **判断に迷う場合**: ユーザーに相談する（自己判断でスキップしない）
