---
name: restore
description: セッション復帰時のジャーナル確認・前回作業の把握
user-invocable: true
allowed-tools: Bash, Read
argument-hint: "[件数]"
---

## タスク

セッション復帰時に前回のジャーナルを読み、作業状況を把握する。MEMORY.md と最新のジャーナルエントリから、前回どこまで進んだか・次に何をすべきかを要約してユーザーに報告する。

## 引数

`$ARGUMENTS` の形式:

- 引数なし: 直近1件のジャーナルを表示
- `N`（数値）: 直近N件のジャーナルを表示

## メモリディレクトリの特定

Claude Code のシステムプロンプトに `You have a persistent auto memory directory at ...` として提供されるパスを直接使用する。

## 処理手順

### ステップ1: MEMORY.md の確認

`$MEMORY_DIR/MEMORY.md` を読み、「進行中タスク」セクションから現在の作業状況を把握する。

### ステップ2: 直近ジャーナルの読み込み

`$MEMORY_DIR/journal/` ディレクトリから、ファイル名のソート順で最新のN件（デフォルト1件）を取得して読む。

**件数の決定**: `$ARGUMENTS` が数値ならその値、未指定または非数値なら1件をデフォルトとする。

**取得方法**: Bash で `ls -1` を使い、ファイル名降順で先頭N件を取得して Read ツールで読む。

```bash
ls -1 "$MEMORY_DIR/journal/"*.md 2>/dev/null | sort -r | head -n N
```

`journal/` ディレクトリが存在しない場合はエラーハンドリングに従う。

### ステップ3: ユーザーへの報告

読んだ情報を元に、以下を報告する:

```text
🔄 前回のセッションから復帰

📓 直近のジャーナル:
- [日時] [タイトル]
  - 概要: [何をやったか]
  - 判断: [迷った点・選んだ選択肢]
  - 気づき: [ポイント]（あれば）

📋 進行中タスク:
- [MEMORY.md の進行中タスクから抜粋]

---
🔜 今日のセッションで着手候補:
- [次にやるべきことの提案]
```

## エラーハンドリング

- `journal/` ディレクトリが存在しない場合: 「ジャーナルが見つかりません」と表示
- ジャーナルが0件の場合: MEMORY.md の情報のみで報告
- MEMORY.md が存在しない場合: ジャーナルの情報のみで報告
