---
name: topic
description: 学びトピックの自動抽出・Zenn記事生成
user-invocable: true
allowed-tools: Bash, Read, Edit, Write, Grep, Glob
argument-hint: "[番号]"
---

## タスク

レトロスペクティブ（`docs/retro/`）やMEMORY.mdから学びトピックを自動抽出し、Zenn形式の記事を生成する。

## 引数

`$ARGUMENTS` の形式:

- 引数なし: トピック候補を自動抽出・表示
- `<番号>`: 選んだトピックの記事を生成

## 処理手順

### A. トピック候補表示（引数なし）

1. **抽出対象のスキャン**
   - `docs/retro/*.md` — レトロスペクティブ
   - `~/.claude/projects/*/memory/MEMORY.md` — Claude Code開発知見

2. **トピック抽出ルール**
   - `## 改善点` `## ハマったこと` セクションを検出
   - 配下の `###` 見出しをトピック候補として抽出
   - 「教訓」「対応」キーワードがあれば優先度UP
   - **自動除外はしない**（過去に記事化したトピックも候補に表示）

3. **候補表示**

   ```text
   📚 学びトピック候補

   1. [★★] RSS 1.0形式での日付取得失敗（docs/retro/f2.md#3）
   2. [★★] skip-summary実装時のコード重複（docs/retro/f2.md#1）
   3. [★] Bot重複起動問題（docs/retro/f2.md#6）
   ...

   👉 記事化するには: /topic <番号>

   ---
   📰 過去の記事化履歴（参考）
   - (2026-02-10) Pythonでプロセス生存確認を実装したら...: docs/retro/process-guard.md#1
   ```

### B. 記事生成（`/topic <番号>`）

1. **トピック情報の取得**
   - 指定番号のトピックをスキャン結果から取得
   - ソースファイルの該当セクションを読み込み

2. **LLMで記事生成**
   - Zennフロントマター形式で生成
   - ソースセクションの内容を元に構造化

3. **ファイル出力**
   - `docs/zenn-drafts/{topic-slug}.md` に保存
   - `docs/zenn-drafts/published.txt` に日付・タイトル・ソース参照を追記
     - 形式: `- (YYYY-MM-DD) タイトル: ソース参照`

4. **結果表示**

   ```text
   ✅ 記事を生成しました: docs/zenn-drafts/rss-date-parsing.md
   ```

## Zenn記事テンプレート

```markdown
---
title: "{タイトル}"
emoji: "{自動選択}"
type: "tech"
topics: ["{tag1}", "{tag2}"]
published: false
---

## TL;DR

> この記事は開発中に起こった問題を元に、Claude Codeが自動生成しました。

{3行で要約}

## 背景

{なぜこの問題に遭遇したか}

## 問題

{何が起きたか}

## 解決策

{どう解決したか、コード例}

## まとめ

{学びのポイント}
```

## 抽出ロジック詳細

### 優先度スコアリング

| 条件 | スコア加算 |
|------|-----------|
| セクションに「教訓」が含まれる | +2 |
| セクションに「対応」が含まれる | +1 |
| コードブロックが含まれる | +1 |
| 「問題」「原因」キーワードがある | +1 |

### ソース参照形式

`{相対パス}#{セクション番号}`

例: `docs/retro/f2.md#3` は f2.md の3番目の `###` 見出し

## エラーハンドリング

- 番号が範囲外:

  ```text
  エラー: 番号 {N} は候補にありません。`/topic` で候補を確認してください。
  ```

- レトロファイルが見つからない:

  ```text
  ⚠️ レトロスペクティブが見つかりませんでした。
  先に機能を実装し、`/doc-gen retro <feature>` でレトロを作成してください。
  ```

## 注意事項

- 生成された記事は必ずレビューしてから公開する
- `published: false` で生成されるため、Zenn上で確認後に `true` に変更
- **記事生成後のチームレビュー（公開前必須）:**
  - 事実確認: 実際に確認した環境・条件と記述が一致しているか
  - 推敲: 技術的な誤りがないか、誤解を招く表現がないか
  - 正直さ: 未確認の内容は「ドキュメントによると」「一般的には」と注記しているか
  - エージェントチェック: test-runner（テスト実行）、doc-reviewer（ドキュメント整合性）
- Zenn AIからレビュー指摘を受けた場合:
  - 指摘を鵜呑みにせず、技術的妥当性を判断する
  - 妥当な指摘のみ対応し、不要な修正はしない
