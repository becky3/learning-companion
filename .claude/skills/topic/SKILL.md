---
name: topic
description: 学びトピックの自動抽出・Zenn記事生成
user-invocable: true
allowed-tools: Bash, Read, Edit, Write, Grep, Glob
argument-hint: "[テーマ]"
---

## タスク

ジャーナル（`$MEMORY_DIR/journal/`）、MEMORY.md、GitHub Issue、仕様書、コードからZenn形式の記事を生成する。

## 引数

`$ARGUMENTS` の形式:

- **引数なし**: トピック候補を自動提案 → ユーザーが番号で選択 → 記事生成（Phase A → B）
- **`<テーマ>`**: テーマを直接指定 → 素材を自律収集 → 記事生成（Phase B）

テーマは自由文。例:

- `/topic auto-fixワークフローの全体像を紹介する記事`
- `/topic Windows Git Bashでハマったポイント集`
- `/topic auto-fix-workflow-overview.md のドラフトを改善して`

## 処理手順

### A. トピック候補提案（引数なし）

1. **抽出対象のスキャン**
   - `$MEMORY_DIR/journal/*.md` — ジャーナル（primary、レトロ変換ファイル含む）
   - `~/.claude/projects/*/memory/MEMORY.md` — Claude Code開発知見

2. **プロジェクトテーマのスキャン**
   - `docs/specs/*.md` — 仕様書から記事化できそうなテーマを抽出
   - `gh issue list --state closed` — 完了済み Issue
   - `$MEMORY_DIR/journal/*-retro-*.md` — レトロスペクティブ

3. **トピック抽出ルール**
   - ジャーナル形式: `- **気づき**:` / `- **判断**:` / `- **教訓**:` を検出しトピック候補として抽出
   - レトロ形式（`retro-` プレフィックス付きジャーナルファイル用）: `## 改善点` `## ハマったこと` セクションを検出し、配下の `###` 見出しをトピック候補として抽出
   - プロジェクトテーマ: 仕様書のタイトル・概要、Issue のタイトルから「記事にできそうなテーマ」を抽出
   - 「教訓」「対応」キーワードがあれば優先度UP
   - **自動除外はしない**（過去に記事化したトピックも候補に表示）

4. **候補表示**

   ```text
   📚 学びトピック候補

   ── TIL・ハマりネタ ──
   1. [★★] RSS 1.0形式での日付取得失敗（memory/journal/20260215-xxx.md）
   2. [★★] skip-summary実装時のコード重複（memory/journal/20260214-xxx.md）
   3. [★] Bot重複起動問題（memory/journal/20260208-072735-retro-f2-feed-collection.md#6）

   ── プロジェクト紹介ネタ ──
   4. auto-fixワークフロー（Issue → 実装 → レビュー → マージの全自動パイプライン）
   5. エージェントチーム機能（複数AIが協調して開発タスクを処理）

   👉 番号を返事してください

   ---
   📰 過去の記事化履歴（参考）
   - (2026-02-10) Pythonでプロセス生存確認を実装したら...: memory/journal/20260210-xxx.md
   ```

5. **ユーザーの返事を待つ**
   - ユーザーが番号で返事 → Phase B へ進む

### B. 記事生成

番号選択またはテーマ指定のどちらでも、以下の流れで記事を生成する。

1. **素材の収集**
   - 番号選択の場合: スキャン結果からソースファイルの該当セクションを読み込み
   - テーマ指定の場合: テーマをキーに関連素材を自律収集
     - GitHub Issue（`gh issue list` / `gh issue view`）
     - 仕様書（`docs/specs/`）
     - ジャーナル・レトロ（`$MEMORY_DIR/journal/`）
     - コード・ワークフロー（テーマに関連するファイル）
     - 既存ドラフト（`docs/zenn-drafts/`）
   - 素材が不足している場合はユーザーに報告し、追加情報を求める

2. **記事タイプの自動判定**
   - 収集した素材を分析し、最適なテンプレートを選択（「記事タイプ自動判定」参照）
   - 判定結果はユーザーに表示して確認を取る

3. **記事生成**
   - 選択されたテンプレートと執筆品質ガイドラインに従い生成
   - スクリーンショット・挿絵が効果的な箇所に画像プレースホルダーを挿入（後述「挿絵・スクリーンショットの指示」参照）

4. **ファイル出力**
   - `docs/zenn-drafts/{topic-slug}.md` に保存
   - `docs/zenn-drafts/published.txt` に日付・タイトル・ソース参照を追記
     - 形式: `- (YYYY-MM-DD) タイトル: ソース参照`

5. **結果表示**

   ```text
   ✅ 記事を生成しました: docs/zenn-drafts/rss-date-parsing.md
   ```

## 記事タイプ自動判定

ソース内容を分析し、最適な記事タイプを判定する。ユーザーは記事タイプを指定しない。

| シグナル | 判定タイプ |
|---------|-----------|
| 「問題」「エラー」「原因」「解決」「ハマった」 | 課題解決型 |
| 「アーキテクチャ」「全体像」「フロー」「設計」「仕組み」「ワークフロー」 | プロジェクト紹介型 |
| 独立した Tips / ポイントが3つ以上列挙 | ノウハウ型 |
| 上記いずれにも該当しない | 課題解決型（デフォルト） |

判定結果はユーザーに表示して確認を取る。

## 記事テンプレート

判定タイプに応じたテンプレートを参照:

- 課題解決型 → `.claude/skills/topic/template-problem.md`
- プロジェクト紹介型 → `.claude/skills/topic/template-project.md`
- ノウハウ型 → `.claude/skills/topic/template-tips.md`

## 執筆品質ガイドライン

**記事生成前に必ず `.claude/skills/topic/quality-guidelines.md` を読み込むこと。**

## 抽出ロジック詳細

### 優先度スコアリング

候補一覧の並び順に使用する。

| 条件 | スコア加算 |
|------|-----------|
| セクションに「教訓」が含まれる | +2 |
| セクションに「対応」が含まれる | +1 |
| コードブロックが含まれる | +1 |
| 「問題」「原因」キーワードがある | +1 |

### ソース参照形式

`{相対パス}#{セクション番号}`

例:

- ジャーナル: `memory/journal/20260217-xxx.md`
- レトロ変換ファイル: `memory/journal/20260208-072735-retro-f2-feed-collection.md#3`（3番目の `###` 見出し）

## エラーハンドリング

- 番号が範囲外:

  ```text
  エラー: 番号 {N} は候補にありません。
  ```

- ジャーナルが見つからない:

  ```text
  ⚠️ ジャーナルが見つかりませんでした。
  ジャーナルは `/merged` 実行時に自動作成されます。
  ```

- 素材が不足:

  ```text
  ⚠️ テーマ「{テーマ}」に関連する素材が十分に見つかりませんでした。
  追加情報を教えてください（関連 Issue 番号、ファイルパス等）。
  ```

## 挿絵・スクリーンショットの指示

記事生成時、画面のスクリーンショットや挿絵があると読者の理解を助ける箇所に、画像プレースホルダーを挿入する。

**プレースホルダー形式:**

```text
{{画像の説明}}
```

**例:**

- `{{PR画面、コメント部分のスクショ}}`
- `{{GitHub Actionsのワークフロー実行結果画面}}`
- `{{エラーメッセージが表示されたターミナル画面}}`
- `{{設定画面のスクショ}}`

**使い分けルール:**

- 画面UI・実行結果・エラー画面・操作手順など → `{{画像の説明}}` プレースホルダーを使用
- DB関係図・シーケンス図・フローチャートなど技術的な図表 → mermaid コードブロックを使用（従来通り）
- 1記事あたり2〜5箇所程度を目安に、効果的な箇所にのみ挿入する（過剰に入れない）
- プレースホルダーはユーザーが後から実際の画像に差し替える前提

## 注意事項

- 生成された記事は必ずレビューしてから公開する
- `published: false` で生成されるため、Zenn上で確認後に `true` に変更
- **記事生成後のチームレビュー（公開前必須）:**
  - 事実確認: 実際に確認した環境・条件と記述が一致しているか
  - 推敲: 技術的な誤りがないか、誤解を招く表現がないか
  - 正直さ: 未確認の内容は「ドキュメントによると」「一般的には」と注記しているか
- Zenn AIからレビュー指摘を受けた場合:
  - 指摘を鵜呑みにせず、技術的妥当性を判断する
  - 妥当な指摘のみ対応し、不要な修正はしない
