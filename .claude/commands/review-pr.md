---
description: "PR Review Toolkit による包括的PRレビュー"
argument-hint: "[review-aspects]"
allowed-tools: Bash, Glob, Grep, Read, Task
---

# 包括的PRレビュー

PR Review Toolkit の複数の専門エージェントを使用して、コード品質の異なる側面に焦点を当てた包括的なプルリクエストレビューを実行します。

**レビュー観点（オプション）:** "$ARGUMENTS"

## レビューワークフロー

### 1. レビュー範囲の決定

- git status で変更ファイルを特定
- 引数を解析してユーザーが特定のレビュー観点を要求しているか確認
- デフォルト: 適用可能なすべてのレビューを実行

### 2. 利用可能なレビュー観点

| 観点 | エージェント | 説明 |
|------|-------------|------|
| `comments` | prt-comment-analyzer | コードコメントの正確性と保守性 |
| `tests` | prt-test-analyzer | テストカバレッジの品質と完全性 |
| `errors` | prt-silent-failure-hunter | サイレント障害のエラーハンドリング |
| `types` | prt-type-design-analyzer | 型設計と不変条件（新しい型がある場合） |
| `code` | prt-code-reviewer | プロジェクトガイドラインの一般的なコードレビュー |
| `simplify` | prt-code-simplifier | 明確さと保守性のためのコード簡素化 |
| `all` | 全エージェント | 適用可能なすべてのレビューを実行（デフォルト） |

### 3. 変更ファイルの特定

```bash
# 変更ファイルを確認
git diff --name-only

# PRが既に存在するか確認
gh pr view
```

### 4. 適用可能なレビューの決定

変更内容に基づく:

- **常に適用**: prt-code-reviewer（一般的な品質）
- **テストファイルが変更された場合**: prt-test-analyzer
- **コメント/ドキュメントが追加された場合**: prt-comment-analyzer
- **エラーハンドリングが変更された場合**: prt-silent-failure-hunter
- **型が追加/変更された場合**: prt-type-design-analyzer
- **レビュー通過後**: prt-code-simplifier（ポリッシュと改善）

### 5. レビューエージェントの起動

**順次アプローチ**（一度に1つ）:

- 理解しやすく、対応しやすい
- 次のレポートの前に各レポートが完了
- インタラクティブなレビューに適している

**並列アプローチ**（ユーザーが要求可能）:

- すべてのエージェントを同時に起動
- 包括的なレビューに高速
- 結果がまとめて返される

### 6. 結果の集約

エージェント完了後、以下を要約:

- **重大な問題**（マージ前に修正必須）
- **重要な問題**（修正すべき）
- **提案**（あると良い）
- **良い点**（適切に行われていること）

### 7. アクションプランの提供

```markdown
# PRレビューサマリー

## 重大な問題（X件発見）
- [エージェント名]: 問題の説明 [file:line]

## 重要な問題（X件発見）
- [エージェント名]: 問題の説明 [file:line]

## 提案（X件発見）
- [エージェント名]: 提案 [file:line]

## 強み
- このPRで適切に行われていること

## 推奨アクション
1. まず重大な問題を修正
2. 重要な問題に対処
3. 提案を検討
4. 修正後にレビューを再実行
```

## 使用例

**フルレビュー（デフォルト）:**

```
/review-pr
```

**特定の観点:**

```
/review-pr tests errors
# テストカバレッジとエラーハンドリングのみレビュー

/review-pr comments
# コードコメントのみレビュー

/review-pr simplify
# レビュー通過後にコードを簡素化
```

**並列レビュー:**

```
/review-pr all parallel
# すべてのエージェントを並列で起動
```

## 既存サブエージェントとの違い

| 観点 | 既存サブエージェント | PR Review Toolkit |
|------|---------------------|-------------------|
| コードレビュー | code-reviewer（汎用） | prt-code-reviewer（信頼度スコア付き、80以上のみ報告） |
| テスト | test-runner（pytest実行） | prt-test-analyzer（カバレッジ品質分析、実行はしない） |
| ドキュメント | doc-reviewer（品質レビュー） | prt-comment-analyzer（コメント正確性分析） |
| エラー処理 | - | prt-silent-failure-hunter（専門分析） |
| 型設計 | - | prt-type-design-analyzer（1-10スケール評価） |
| 簡素化 | - | prt-code-simplifier（リファクタリング） |

**使い分け:**

- **test-runner**: テストを実際に実行して結果を確認したい場合
- **prt-test-analyzer**: テストの品質・網羅性を分析したい場合
- **code-reviewer**: 既存の8カテゴリレビューを使いたい場合
- **prt-code-reviewer**: 信頼度スコア付きの厳選された指摘が欲しい場合

## ワークフロー統合

**コミット前:**

```
1. コードを書く
2. 実行: /review-pr code errors
3. 重大な問題を修正
4. コミット
```

**PR作成前:**

```
1. すべての変更をステージ
2. 実行: /review-pr all
3. すべての重大・重要な問題に対処
4. 再度特定のレビューを実行して確認
5. PRを作成
```

**PRフィードバック後:**

```
1. 要求された変更を行う
2. フィードバックに基づいてターゲットレビューを実行
3. 問題が解決されたことを確認
4. 更新をプッシュ
```

## 注意事項

- エージェントは自律的に実行し、詳細なレポートを返す
- 各エージェントは専門分野に焦点を当てた深い分析を行う
- 結果は具体的な file:line 参照で実行可能
- すべてのエージェントは `.claude/agents/` で利用可能
